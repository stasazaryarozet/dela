# Автосинхронизация календарей

## ✅ Настроено

### Локальная автосинхронизация (macOS)
- **Демон:** `sync_daemon.py`
- **Запуск:** каждые 5 минут через `launchd`
- **Конфигурация:** `~/Library/LaunchAgents/ru.olgarozet.sync.plist`
- **Логи:** `sync.log`, `sync.error.log`

### Что синхронизируется автоматически:
1. ✅ Cal.com → проверка каждые 5 минут
2. ✅ Telegram канал → автообновление из `posts/001_links.md`
3. ✅ Git → автокоммит изменений
4. ⚠️ GitHub push → когда доступен (сейчас partial outage)

### GitHub Actions (облачный backup)
- **Workflow:** `.github/workflows/auto-sync.yml`
- **Запуск:** каждые 5 минут
- **Активируется:** после восстановления GitHub

## Управление

### Статус
```bash
launchctl list | grep olgarozet
```

### Логи
```bash
tail -f ~/Library/Mobile\ Documents/com~apple~CloudDocs/○/olga/sync.log
```

### Остановить
```bash
launchctl unload ~/Library/LaunchAgents/ru.olgarozet.sync.plist
```

### Запустить
```bash
launchctl load ~/Library/LaunchAgents/ru.olgarozet.sync.plist
```

### Тест вручную
```bash
cd ~/Library/Mobile\ Documents/com~apple~CloudDocs/○/olga
python3 sync_daemon.py
```

## Архитектура

```
┌─────────────────────────────────────────────────────┐
│             launchd (каждые 5 минут)                │
└──────────────────┬──────────────────────────────────┘
                   │
                   ▼
         ┌─────────────────┐
         │  sync_daemon.py │
         └────────┬─────────┘
                  │
      ┌───────────┼───────────┐
      │           │           │
      ▼           ▼           ▼
┌──────────┐ ┌─────────┐ ┌─────────┐
│ Cal.com  │ │Telegram │ │   Git   │
│  API v2  │ │Bot API  │ │ commit  │
└──────────┘ └─────────┘ └────┬────┘
                               │
                               ▼ (когда доступен)
                         ┌──────────┐
                         │  GitHub  │
                         │  Pages   │
                         └──────────┘
```

## Результат последнего теста

```
[2025-11-19 00:40:47] 🔄 Запуск синхронизации...
[2025-11-19 00:40:47] 📊 Проверка Cal.com...
[2025-11-19 00:40:48]    Event Types: 1
[2025-11-19 00:40:48]    Bookings: 0
[2025-11-19 00:40:48] ⚠️ Описание устарело, но обновление отложено (ручной контроль)
[2025-11-19 00:40:48] 📱 Синхронизация Telegram...
[2025-11-19 00:40:52] ✅ Telegram обновлен
[2025-11-19 00:40:52] ✅ Изменений нет
[2025-11-19 00:40:52] ✅ Синхронизация завершена
```

## Забота о человеке

### Для пользователей:
- ✅ Информация всегда актуальна (автообновление каждые 5 минут)
- ✅ Бронирование работает в реальном времени через Cal.com
- ✅ Telegram канал обновляется автоматически

### Для Ольги:
- ✅ Не требуется ручное вмешательство
- ✅ Все изменения логируются
- ✅ Автоматический откат при ошибках (git)
- ✅ Работает даже при недоступности GitHub

## Пилотный слот

Для настройки пилотного слота 21 ноября:
1. Открыть: https://app.cal.com/availability
2. Add date override → 21 ноября → время начала → Save
3. Автосинхронизация подхватит изменения в течение 5 минут


